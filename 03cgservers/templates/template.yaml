# Auto-generated by TNG transpiler version 6c01dd1a3e5404a0ad15c92c8b0a564733f688ee
{{- $ns := .Release.Namespace -}}
{{- $__index__ := 0 }}
{{- $inputs := .Values }}
{{- $__prev_index__ := $__index__ }}
{{- $__index__ = 0 }}
{{- range $l, $label := $inputs.myLabels }}
{{- if (eq $label.name $inputs.myClientGroup) }}
{{- $__prev_index__ := $__index__ }}
{{- $__index__ = 0 }}
{{- range $k, $node := $inputs.myNodes }}
{{- if (eq $node.kind "srl") }}
{{- if (eq $k 0) }}
---
apiVersion: srlinux.henderiw.be/v1alpha1
kind: SrlInterface
metadata:
    labels: 
        target: {{ $label.allNetworkDevices }}

    name: cg-{{ $label.name }}-{{ $label.allNetworkDevices }}
    namespace: {{ $ns }}
spec:
    interface: 
        {{- $empty_level_2 := true }}
        {{- $__prev_index__ := $__index__ }}
        {{- $__index__ = 0 }}
        {{- range $index, $ep := $node.endpoints }}
        {{- if (eq $ep.kind $label.name) }}
        {{- $empty_level_2 = false }}
        - 
            name: {{ $ep.name }}
            admin-state: "enable"
            description: "tng-k8s{{$ep.name}}"
            {{- if (eq $ep.lag "") }}
            vlan-tagging: {{ $ep.vlanTagging }}
            {{- end }}
            {{- if (contains "lag" $ep.name) }}
            lag: 
                lag-type: "lacp"
                member-speed: {{ $ep.portSpeed }}
                lacp-fallback-mode: "static"
                lacp: 
                    interval: "FAST"
                    lacp-mode: "ACTIVE"
                    admin-key: {{ $ep.adminKey }}
                    system-id-mac: {{ $ep.systemIdMac }}


            {{- end }}
            {{- if (contains "ethernet" $ep.name) }}
            ethernet: 
                port-speed: {{ $ep.portSpeed }}
                aggregate-id: {{ $ep.lag }}

            {{- end }}

        {{- $__index__ = add $__index__ 1 }}
        {{- end }}
        {{- $__index__ = $__prev_index__ }}
        {{- end }}
        {{- if $empty_level_2 }}
        []
        {{- end }}

{{- $__index__ = add $__index__ 1 }}
{{- end }}
{{- $__index__ = $__prev_index__ }}
{{- end }}
{{- $__index__ = add $__index__ 1 }}
{{- end }}
{{- $__index__ = $__prev_index__ }}
{{- end }}
{{- end }}
{{- $__prev_index__ := $__index__ }}
{{- $__index__ = 0 }}
{{- range $l, $label := $inputs.myLabels }}
{{- if (eq $label.name $inputs.myClientGroup) }}
---
apiVersion: srlinux.henderiw.be/v1alpha1
kind: SrlSystemNetworkinstanceProtocolsEvpnEsisBgpinstanceEsi
metadata:
    labels: 
        target: {{ $label.allNetworkDevices }}

    name: cg-{{ $label.name }}
    namespace: {{ $ns }}
spec:
    bgp-instance-id: "1"
    ethernet-segment: 
        {{- $empty_level_2 := true }}
        {{- $__prev_index__ := $__index__ }}
        {{- $__index__ = 0 }}
        {{- range $k, $node := $inputs.myNodes }}
        {{- if (eq $node.kind "srl") }}
        {{- if (eq $k 0) }}
        {{- $__prev_index__ := $__index__ }}
        {{- $__index__ = 0 }}
        {{- range $index, $ep := $node.endpoints }}
        {{- if (eq $ep.kind $label.name) }}
        {{- if (contains "lag" $ep.name) }}
        {{- $empty_level_2 = false }}
        - 
            name: {{ $ep.esi }}
            admin-state: "enable"
            interface: {{ $ep.name }}

        {{- $__index__ = add $__index__ 1 }}
        {{- end }}
        {{- $__index__ = $__prev_index__ }}
        {{- end }}
        {{- end }}
        {{- $__index__ = add $__index__ 1 }}
        {{- end }}
        {{- $__index__ = $__prev_index__ }}
        {{- end }}
        {{- end }}
        {{- if $empty_level_2 }}
        []
        {{- end }}

{{- $__index__ = add $__index__ 1 }}
{{- end }}
{{- $__index__ = $__prev_index__ }}
{{- end }}
